<h2>Viajes previstos</h2>

<ul>
  <li *ngFor="let viaje of viajesPrevistos; index as i" class="viaje-item">
    <div class="viaje-info">
      <strong class="destino">{{ viaje.destino }}</strong>

      <!-- ‚ú® NUEVO: Rangos de fechas de itinerarios -->
      <div class="rangos-fechas" *ngIf="rangosFechasPorViaje[viaje.id]">
        <ng-container *ngIf="rangosFechasPorViaje[viaje.id].rangos.length === 1">
          <!-- Un solo rango: mostrar directamente -->
          <div class="rango-unico">
            üìÖ {{ formatearRango(rangosFechasPorViaje[viaje.id].rangos[0]) }}
            <span class="badge-dias">({{ rangosFechasPorViaje[viaje.id].total }} d√≠as)</span>
          </div>
        </ng-container>

        <ng-container *ngIf="rangosFechasPorViaje[viaje.id].rangos.length > 1">
          <!-- M√∫ltiples rangos: mostrar con desplegable -->
          <div class="rangos-multiples">
            <div class="rango-principal" (click)="toggleDesplegable(viaje.id)">
              <span class="rango-texto">
                üìÖ {{ formatearRango(rangosFechasPorViaje[viaje.id].rangos[0]) }}
              </span>
              <span class="badge-dias">({{ rangosFechasPorViaje[viaje.id].total }} d√≠as total)</span>
              <span class="icono-desplegable" [class.abierto]="desplegablesAbiertos[viaje.id]">
                ‚ñº
              </span>
            </div>

            <!-- Rangos adicionales (desplegables) -->
            <div class="rangos-adicionales" *ngIf="desplegablesAbiertos[viaje.id]">
              <div class="rango-item" *ngFor="let rango of rangosFechasPorViaje[viaje.id].rangos.slice(1)">
                üìÖ {{ formatearRango(rango) }}
                <span class="badge-dias-secundario">({{ rango.dias }} d√≠as)</span>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <p class="descripcion">{{ viaje.descripcion }}</p>
    </div>
    <div class="acciones">
      <button (click)="verAlbumEnLibro(viaje.id)" class="btn-album">
        <i class="fa fa-book"></i> √Ålbum
      </button>

      <button (click)="eliminarViaje(viaje.id)" class="btn-eliminar">
        <i class="fa fa-trash"></i> Eliminar
      </button>
      <button (click)="irAEditarViaje(viaje.id)" class="btn-actualizar">
        <i class="fa fa-pencil"></i> Actualizar
      </button>
      <!-- Agregamos un bot√≥n que navegue a la p√°gina de itinerarios del viaje -->
      <button [routerLink]="['/itinerarios', viaje.id]" class="btn-itinerarios">
        <i class="fa fa-map"></i> Ver itinerarios
      </button>
    </div>
  </li>
</ul>

<div class="acciones-globales">
  <button (click)="irAlFormulario()" class="btn-agregar">
    <i class="fa fa-plus"></i> A√±adir viaje
  </button>

  <button (click)="ejecutarUnificacion()" class="btn-unificar">
    <i class="fa fa-compress"></i> Unificar Destinos
  </button>
</div>