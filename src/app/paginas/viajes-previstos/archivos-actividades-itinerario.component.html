<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- üìã CONTENEDOR PRINCIPAL - Gesti√≥n de Archivos por Actividad -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<div class="contenedor">

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- üìå ENCABEZADO -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <h2 *ngIf="actividadId">Archivos para la Actividad {{ actividadId }}</h2>

  <!-- Bot√≥n para a√±adir nuevo archivo -->
  <button [routerLink]="[
      '/viajes-previstos',
      viajePrevistoId,
      'itinerarios',
      itinerarioId,
      'actividades',
      actividadId,
      'archivos',
      'nuevo'
    ]" class="btn-agregar" title="A√±adir nuevo archivo a esta actividad">
    <i class="fa fa-plus-circle"></i> A√±adir Archivo
  </button>

  <router-outlet></router-outlet>
  <hr>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- üìÅ LISTA DE ARCHIVOS O MENSAJE DE LISTA VAC√çA -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

  <div *ngIf="archivos && archivos.length > 0; else sinArchivos" class="lista-archivos">

    <!-- üîÑ ITERACI√ìN: Cada archivo -->
    <div *ngFor="let archivo of archivos" class="archivo-item">

      <!-- ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó -->
      <!-- ‚ïë SECCI√ìN 1: PREVIEW DEL ARCHIVO (Imagen, Video o Audio) -->
      <!-- ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù -->
      <div class="preview-container">

        <!-- Vista previa: Foto/Imagen -->
        <div *ngIf="archivo.tipo === 'foto' || archivo.tipo === 'imagen'" class="image-preview">
          <img [src]="getFileUrl(archivo)" [alt]="archivo.descripcion || 'Imagen sin descripci√≥n'"
            (click)="abrirModal(archivo)" (error)="onImgError($event)" class="clickable-media" loading="lazy"
            crossorigin="anonymous" title="Clic para abrir en modal ampliado">
        </div>

        <!-- Vista previa: Video -->
        <div *ngIf="archivo.tipo === 'video'" class="video-preview">
          <video controls preload="metadata" (click)="abrirModal(archivo)" class="clickable-media"
            title="Clic para abrir en modal ampliado">
            <source [src]="getFileUrl(archivo)" [type]="'video/' + getFileExtension(archivo.nombreArchivo)">
            Tu navegador no soporta el elemento de video.
          </video>
        </div>

        <!-- Vista previa: Audio -->
        <div *ngIf="archivo.tipo === 'audio'" class="audio-preview">
          <audio controls preload="metadata" (click)="abrirModal(archivo)" class="clickable-media"
            title="Clic para abrir en modal ampliado">
            <source [src]="getFileUrl(archivo)" [type]="'audio/' + getFileExtension(archivo.nombreArchivo)">
            Tu navegador no soporta el elemento de audio.
          </audio>
        </div>

        <!-- Indicador de carga -->
        <div
          *ngIf="!urlsArchivos[archivo.id] && (archivo.tipo === 'foto' || archivo.tipo === 'imagen' || archivo.tipo === 'video' || archivo.tipo === 'audio')"
          class="loading-indicator">
          <i class="fa fa-spinner fa-spin"></i> Cargando...
        </div>
      </div>

      <!-- ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó -->
      <!-- ‚ïë SECCI√ìN 2: INFORMACI√ìN DEL ARCHIVO -->
      <!-- ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù -->
      <div class="info-archivo">
        <h3>{{ archivo.nombreArchivo }}</h3>
        <p><strong>Tipo:</strong> {{ archivo.tipo }}</p>
        <p><strong>Descripci√≥n:</strong> {{ archivo.descripcion || 'Sin descripci√≥n' }}</p>
        <p><strong>Hora de captura:</strong> {{ archivo.horaCaptura || 'No especificada' }}</p>

        <!-- Ubicaci√≥n (Direcci√≥n) -->
        <p class="ubicacion-field">
          <strong>üìç Ubicaci√≥n:</strong>
          <span class="direccion-text">{{ getDireccionDisplay(archivo) }}</span>
        </p>

        <p><strong>Creaci√≥n:</strong> {{ archivo.fechaCreacion | date:'dd/MM/yyyy' }}</p>
      </div>

      <!-- ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó -->
      <!-- ‚ïë SECCI√ìN 3: BOTONES DE ACCIONES -->
      <!-- ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù -->
      <div class="acciones">

        <!-- üéØ BOTONES DE ARCHIVOS ASOCIADOS (Generados din√°micamente) -->

        <!-- Audio asociado -->
        <button class="btn-asociado btn-audio" *ngIf="tieneArchivoAsociado(archivo, 'audio')"
          (click)="abrirArchivoAsociado(archivo, 'audio')" title="Reproducir audio asociado">
          <i class="fa fa-volume-up"></i>
        </button>

        <!-- GPX asociado - Abre mapa satelital -->
        <button class="btn-asociado btn-gpx" *ngIf="tieneArchivoAsociado(archivo, 'gpx')"
          (click)="abrirArchivoAsociado(archivo, 'gpx')" title="Ver ruta GPX en mapa satelital">
          <i class="fa fa-map-marked-alt"></i>
        </button>

        <!-- Mapa de ubicaci√≥n (PNG) -->
        <button class="btn-asociado btn-imagen" *ngIf="tieneArchivoAsociado(archivo, 'mapa_ubicacion')"
          (click)="abrirArchivoAsociado(archivo, 'mapa_ubicacion')" title="Ver mapa PNG">
          <i class="fa fa-map"></i>
        </button>

        <!-- Manifest JSON -->
        <button class="btn-asociado btn-manifest" *ngIf="tieneArchivoAsociado(archivo, 'manifest')"
          (click)="abrirArchivoAsociado(archivo, 'manifest')" title="Ver manifest JSON">
          <i class="fa fa-file-code"></i>
        </button>

        <!-- Estad√≠sticas JSON -->
        <button class="btn-asociado btn-estadisticas" *ngIf="tieneArchivoAsociado(archivo, 'estadisticas')"
          (click)="abrirArchivoAsociado(archivo, 'estadisticas')" title="Ver estad√≠sticas">
          <i class="fa fa-chart-bar"></i>
        </button>

        <!-- Texto asociado -->
        <button class="btn-asociado btn-texto" *ngIf="tieneArchivoAsociado(archivo, 'texto')"
          (click)="abrirArchivoAsociado(archivo, 'texto')" title="Ver texto asociado">
          <i class="fa fa-file-text"></i>
        </button>

        <!-- Buscar en AudioPhotoApp (solo si NO tiene archivos asociados) -->
        <button class="btn-asociado btn-buscar-audio" *ngIf="!tieneArchivosAsociados(archivo)"
          (click)="buscarEnAudioPhotoApp(archivo)" title="Buscar archivos asociados en AudioPhotoApp">
          <i class="fa fa-folder-open"></i>
        </button>

        <!-- Separador visual -->
        <span class="separador-botones"></span>

        <!-- üéØ BOTONES DE GESTI√ìN DEL ARCHIVO -->

        <!-- Descargar -->
        <button class="btn-descargar" (click)="descargarArchivo(archivo.id)" title="Descargar archivo">
          <i class="fa fa-download"></i>
        </button>

        <!-- Eliminar -->
        <button class="btn-eliminar" (click)="eliminarArchivo(archivo.id)" title="Eliminar archivo">
          <i class="fa fa-trash"></i>
        </button>

        <!-- Editar -->
        <button class="btn-actualizar" [routerLink]="[
            '/viajes-previstos',
            viajePrevistoId,
            'itinerarios',
            itinerarioId,
            'actividades',
            actividadId,
            'archivos',
            'editar',
            archivo.id
          ]" title="Editar archivo">
          <i class="fa fa-edit"></i>
        </button>

      </div>
      <!-- FIN: Botones de acciones -->

    </div>
    <!-- FIN: Iteraci√≥n de archivos -->

  </div>
  <!-- FIN: Lista de archivos -->

  <!-- Mensaje cuando no hay archivos -->
  <ng-template #sinArchivos>
    <p class="sin-archivos">
      <em>No hay archivos registrados para esta actividad.</em>
    </p>
  </ng-template>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- ü™ü MODAL 1: VISUALIZACI√ìN AMPLIADA DE ARCHIVO (Foto/Video/Audio) -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="modal-backdrop" *ngIf="archivoSeleccionado" (click)="cerrarModal()" role="dialog"
    aria-label="Vista ampliada del archivo">

    <div class="modal-content" (click)="$event.stopPropagation()">

      <!-- Bot√≥n cerrar -->
      <button class="btn-cerrar-modal" (click)="cerrarModal()" title="Cerrar modal (ESC)">
        <i class="fa fa-times"></i>
      </button>

      <!-- Contenido media: Imagen -->
      <div *ngIf="archivoSeleccionado.tipo === 'foto' || archivoSeleccionado.tipo === 'imagen'" class="modal-media">
        <img [src]="getFileUrl(archivoSeleccionado)" [alt]="archivoSeleccionado.descripcion"
          (error)="onImgError($event)" crossorigin="anonymous">
      </div>

      <!-- Contenido media: Video -->
      <div *ngIf="archivoSeleccionado.tipo === 'video'" class="modal-media">
        <video controls autoplay>
          <source [src]="getFileUrl(archivoSeleccionado)"
            [type]="'video/' + getFileExtension(archivoSeleccionado.nombreArchivo)">
          Tu navegador no soporta el elemento de video.
        </video>
      </div>

      <!-- Contenido media: Audio -->
      <div *ngIf="archivoSeleccionado.tipo === 'audio'" class="modal-media">
        <audio controls autoplay>
          <source [src]="getFileUrl(archivoSeleccionado)"
            [type]="'audio/' + getFileExtension(archivoSeleccionado.nombreArchivo)">
          Tu navegador no soporta el elemento de audio.
        </audio>
      </div>

      <!-- Informaci√≥n del archivo -->
      <div class="modal-info">
        <h3>{{ archivoSeleccionado.nombreArchivo }}</h3>
        <p><strong>Descripci√≥n:</strong> {{ archivoSeleccionado.descripcion || 'Sin descripci√≥n' }}</p>
        <p><strong>Fecha:</strong> {{ archivoSeleccionado.fechaCreacion | date:'dd/MM/yyyy' }}</p>
        <p><strong>Hora:</strong> {{ archivoSeleccionado.horaCaptura || 'No especificada' }}</p>

        <!-- Ubicaci√≥n -->
        <p class="ubicacion-modal">
          <strong>üìç Ubicaci√≥n:</strong>
          <span>{{ getDireccionDisplay(archivoSeleccionado) }}</span>
        </p>
      </div>

    </div>
  </div>
  <!-- FIN: Modal de visualizaci√≥n ampliada -->

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- üó∫Ô∏è MODAL 2: MAPA SATELITAL CON RUTA GPX INDIVIDUAL -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="modal-backdrop" *ngIf="mostrarModalGPXIndividual" (click)="cerrarModalGPXIndividual()" role="dialog"
    aria-label="Mapa satelital con ruta GPX">

    <div class="modal-content" (click)="$event.stopPropagation()">

      <!-- Bot√≥n cerrar -->
      <button class="btn-cerrar-modal" (click)="cerrarModalGPXIndividual()" title="Cerrar mapa">
        <i class="fa fa-times"></i>
      </button>

      <!-- Encabezado -->
      <h2 style="margin-top: 0;">üó∫Ô∏è Ruta GPX Individual</h2>
      <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
        Vista satelital de la ruta capturada en esta foto
      </p>

      <!-- ‚ú® CONTENEDOR DEL MAPA LEAFLET ‚ú® -->
      <!-- Leaflet se inicializa aqu√≠ con Satellite + Ruta + Marcadores -->
      <div id="mapa-gpx-individual" style="height: 500px; width: 100%; border-radius: 8px; margin-bottom: 20px;">
        <!-- El mapa se renderiza aqu√≠ por inicializarMapaGPXIndividual() -->
      </div>

      <!-- Bot√≥n cerrar modal -->
      <button class="btn-descargar" (click)="cerrarModalGPXIndividual()" style="width: 100%;">
        <i class="fa fa-times"></i> Cerrar
      </button>

    </div>
  </div>
  <!-- FIN: Modal GPX Individual -->

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- üîç MODAL 3: SELECCI√ìN DE ARCHIVOS DE AUDIOPHOTOAPP -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="modal-backdrop" *ngIf="mostrarModalBusquedaAudio" (click)="cerrarModalBusquedaAudio()" role="dialog"
    aria-label="Selecci√≥n de archivos encontrados">

    <div class="modal-content modal-busqueda" (click)="$event.stopPropagation()">

      <button class="btn-cerrar-modal" (click)="cerrarModalBusquedaAudio()" title="Cerrar">
        <i class="fa fa-times"></i>
      </button>

      <h2 style="margin-top: 0;">üîç Archivos Encontrados</h2>
      <p style="color: #666; font-size: 14px;">
        Buscando: <strong>{{ nombreBaseBusqueda }}</strong>
      </p>

      <!-- Lista de archivos encontrados -->
      <div class="archivos-encontrados-lista">
        <div *ngFor="let archivoEnc of archivosEncontradosAudio" class="archivo-encontrado-item">
          <label>
            <input type="checkbox" [(ngModel)]="archivoEnc.seleccionado">
            <i [class]="getIconoTipo(archivoEnc.tipo)"></i>
            <span class="nombre-archivo">{{ archivoEnc.nombre }}</span>
            <span class="tipo-archivo">({{ archivoEnc.tipo }})</span>
          </label>
        </div>

        <p *ngIf="archivosEncontradosAudio.length === 0" class="sin-resultados">
          No se encontraron archivos asociados
        </p>
      </div>

      <!-- Botones de acci√≥n -->
      <div class="modal-acciones" style="margin-top: 20px; display: flex; gap: 10px;">
        <button class="btn-volver" (click)="cerrarModalBusquedaAudio()">
          Cancelar
        </button>
        <button class="btn-agregar" (click)="importarArchivosSeleccionados()" [disabled]="!hayArchivosSeleccionados()">
          <i class="fa fa-download"></i> Importar Seleccionados
        </button>
      </div>

    </div>
  </div>
  <!-- FIN: Modal AudioPhotoApp -->


  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- üîò BOTONES DE NAVEGACI√ìN INFERIORES -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

  <button class="btn-volver" (click)="volverAItinerario()" title="Volver a la lista de actividades">
    <i class="fa fa-arrow-left"></i> Volver a Actividades por Itinerario
  </button>

  <button class="btn-libro" (click)="verEnFormatoLibro()" title="Ver en formato libro/√°lbum">
    <i class="fas fa-book"></i> Ver en libro
  </button>

</div>
<!-- FIN: Contenedor principal -->