<div class="contenedor">
    <h2>Actividades para el itinerario {{ itinerarioId }}</h2>
  
    <!-- Bot√≥n para a√±adir una nueva actividad -->
    <button [routerLink]="['/formulario-actividad', viajePrevistoId, itinerarioId, 'nuevo']" class="btn-agregar">
      <i class="fa fa-plus-circle"></i> A√±adir Actividad
    </button>
  
    <hr>
  
    <!-- Mostrar formulario de actualizaci√≥n solo cuando se seleccione una actividad -->
    <div *ngIf="actividadActualizada?.id">
      <h3>Actualizar Actividad</h3>
      <form (ngSubmit)="guardarActualizacion()">
        <label for="nombre">Nombre</label>
        <input type="text" id="nombre" [(ngModel)]="actividadActualizada.nombre" name="nombre" required />
  
        <label for="descripcion">Descripci√≥n</label>
        <textarea id="descripcion" [(ngModel)]="actividadActualizada.descripcion" name="descripcion"></textarea>
  
        <label for="horaInicio">Hora de inicio</label>
        <input type="time" id="horaInicio" [(ngModel)]="actividadActualizada.horaInicio" name="horaInicio" required />
  
        <label for="horaFin">Hora de fin</label>
        <input type="time" id="horaFin" [(ngModel)]="actividadActualizada.horaFin" name="horaFin" required />
  
        <button type="submit" class="btn-guardar">Guardar cambios</button>
        <button type="button" class="btn-cancelar" (click)="cancelarActualizacion()">Cancelar</button>
      </form>
      <hr>
    </div>
  
    <!-- Lista de actividades -->
    <div *ngIf="!actividadActualizada?.id">
      <div *ngFor="let actividad of actividades">
        <h3>Actividad {{ actividad.id }}</h3>
        <p><strong>Nombre:</strong> {{ actividad.nombre }}</p>
        <p><strong>Descripci√≥n:</strong> {{ actividad.descripcion }}</p>
        <p><strong>Horario:</strong> {{ actividad.horaInicio }} a {{ actividad.horaFin }}</p>
  
        <!-- ‚ú® CONTENEDOR DE BOTONES DE ACCI√ìN -->
        <div class="acciones-actividad">
          <button class="btn-eliminar" (click)="eliminarActividad(actividad.id)">
            <i class="fa fa-trash"></i> Eliminar
          </button>
          <button class="btn-actualizar" (click)="actualizarActividad(actividad)">
            <i class="fa fa-edit"></i> Actualizar
          </button>
          <button class="btn-ver-archivos" (click)="verArchivos(actividad.id, $event)">
            <i class="fa fa-folder-open"></i> Ver Archivos
          </button>
          
          <!-- ‚ú® NUEVOS BOTONES -->
          <button class="btn-gpx" (click)="verGPX(actividad.id)">
            <i class="fa fa-map-marker"></i> Ver GPX
          </button>
          <button class="btn-mapa" (click)="verMapa(actividad.id)">
            <i class="fa fa-image"></i> Ver Mapa
          </button>
          <button class="btn-estadisticas" (click)="verEstadisticas(actividad.id)">
            <i class="fa fa-bar-chart"></i> Estad√≠sticas
          </button>
        </div>
        
        <hr>
      </div>
    </div>
  
    <button (click)="volverAItinerarios()">
      <i class="fa fa-arrow-left"></i> Volver a Itinerarios
    </button>
</div>

<!-- ‚ú® MODAL MAPA PNG -->
<div class="modal" *ngIf="mostrarModalMapa" (click)="cerrarModalMapa()">
  <div class="modal-contenido" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>üìç Mapa del Recorrido</h3>
      <button class="btn-cerrar" (click)="cerrarModalMapa()">‚úï</button>
    </div>
    <div class="modal-body">
      <img [src]="urlMapaDataURL" alt="Mapa del recorrido" class="mapa-imagen">
    </div>
  </div>
</div>

<!-- ‚ú® MODAL ESTAD√çSTICAS -->
<div class="modal" *ngIf="mostrarModalEstadisticas" (click)="cerrarModalEstadisticas()">
  <div class="modal-contenido modal-estadisticas" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>üìä Estad√≠sticas del Recorrido</h3>
      <button class="btn-cerrar" (click)="cerrarModalEstadisticas()">‚úï</button>
    </div>
    <div class="modal-body" *ngIf="estadisticasActuales">
      <div class="estadistica-grupo">
        <h4>üìå Informaci√≥n General</h4>
        <p><strong>Nombre:</strong> {{ estadisticasActuales.nombre }}</p>
        <p><strong>Descripci√≥n:</strong> {{ estadisticasActuales.descripcion }}</p>
      </div>

      <div class="estadistica-grupo">
        <h4>‚è∞ Horario</h4>
        <p><strong>Inicio:</strong> {{ estadisticasActuales.horario.inicio }}</p>
        <p><strong>Fin:</strong> {{ estadisticasActuales.horario.fin }}</p>
      </div>

      <div class="estadistica-grupo">
        <h4>üìè Distancia</h4>
        <p><strong>Kil√≥metros:</strong> {{ estadisticasActuales.distancia.km }} km</p>
        <p><strong>Metros:</strong> {{ estadisticasActuales.distancia.metros }} m</p>
      </div>

      <div class="estadistica-grupo">
        <h4>‚è±Ô∏è Duraci√≥n</h4>
        <p><strong>Formateada:</strong> {{ estadisticasActuales.duracion.formateada }}</p>
        <p><strong>Segundos:</strong> {{ estadisticasActuales.duracion.segundos }} s</p>
      </div>

      <div class="estadistica-grupo">
        <h4>üèÉ Velocidad</h4>
        <p><strong>Media:</strong> {{ estadisticasActuales.velocidad.media }} km/h</p>
        <p><strong>M√°xima:</strong> {{ estadisticasActuales.velocidad.maxima }} km/h</p>
        <p><strong>M√≠nima:</strong> {{ estadisticasActuales.velocidad.minima }} km/h</p>
      </div>

      <div class="estadistica-grupo">
        <h4>‚ö° Energ√≠a</h4>
        <p><strong>Calor√≠as:</strong> {{ estadisticasActuales.energia.calorias }} kcal</p>
        <p><strong>Pasos:</strong> {{ estadisticasActuales.energia.pasos }}</p>
      </div>

      <div class="estadistica-grupo">
        <h4>üõ∞Ô∏è Tracking</h4>
        <p><strong>Puntos GPS:</strong> {{ estadisticasActuales.tracking.puntosGPS }}</p>
        <p><strong>Perfil de Transporte:</strong> {{ estadisticasActuales.tracking.perfilTransporte }}</p>
      </div>
    </div>
  </div>
</div>

<!-- ‚ú® MODAL MAPA GPX INTERACTIVO CON SAT√âLITE -->
<div class="modal" *ngIf="mostrarModalGPXMapa" (click)="cerrarModalGPXMapa()">
  <div class="modal-contenido modal-mapa-gpx" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>üìç Recorrido GPX en Sat√©lite</h3>
      <button class="btn-cerrar" (click)="cerrarModalGPXMapa()">‚úï</button>
    </div>
    <div class="modal-body">
      <div id="mapa-gpx-container" class="mapa-gpx-interactive"></div>
    </div>
  </div>
</div>
