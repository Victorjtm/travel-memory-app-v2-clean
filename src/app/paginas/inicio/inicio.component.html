<div class="inicio-container">
  <h1>{{ mensajeBienvenida }}</h1>
  <p>Comienza a guardar tus recuerdos de viaje aqu√≠.</p>

  <a routerLink="/planificar-viaje" class="btn">Planificar Viaje</a>
  <a routerLink="/viajes-futuros" class="btn">Viajes Futuros</a>
  <a routerLink="/viajes-previstos" class="btn">Recuerdos</a>

  <!-- Nuevo bot√≥n para seleccionar archivos -->


  <!-- Nuevo bot√≥n para seleccionar archivos -->
  <a routerLink="/formulario-archivos-actividades-itinerario" class="btn">
    Seleccionar Archivos
  </a>

  <!-- ====================================================================== -->
  <!-- NUEVO: Bot√≥n Importar desde M√≥vil                                     -->
  <!-- ====================================================================== -->
  <button class="btn btn-import" (click)="importarDesdeMovil()" title="Importar tracking desde AudioPhotoApp">
    üì§ Importar desde M√≥vil
  </button>
</div>

<!-- ====================================================================== -->
<!-- NUEVO: Modal de Importaci√≥n                                           -->
<!-- ====================================================================== -->
<div class="modal-overlay" *ngIf="mostrarModalImport" (click)="cancelarImportacion()">
  <div class="modal-import" (click)="$event.stopPropagation()">

    <!-- Header del Modal -->
    <div class="modal-header">
      <h2>üì¶ Importar Tracking GPS</h2>
      <button class="btn-close" (click)="cancelarImportacion()" [disabled]="importando">
        ‚úï
      </button>
    </div>

    <!-- Contenido del Modal -->
    <div class="modal-body">

      <!-- ============================================ -->
      <!-- Vista de Configuraci√≥n (antes de importar)  -->
      <!-- ============================================ -->
      <div *ngIf="!importando">

        <!-- Informaci√≥n del Tracking Detectado -->
        <div class="tracking-info" *ngIf="manifestData">
          <h3>üó∫Ô∏è Tracking Detectado</h3>
          <div class="info-grid">
            <div class="info-item">
              <strong>Nombre:</strong>
              <span>{{ manifestData.nombre }}</span>
            </div>
            <div class="info-item">
              <strong>Fecha:</strong>
              <span>{{ manifestData.fecha_exportacion | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
            <div class="info-item">
              <strong>Distancia:</strong>
              <span>{{ manifestData.estadisticas.distancia_km }} km</span>
            </div>
            <div class="info-item">
              <strong>Duraci√≥n:</strong>
              <span>{{ manifestData.estadisticas.duracion_formateada }}</span>
            </div>
            <div class="info-item">
              <strong>Fotos:</strong>
              <span>{{ manifestData.estadisticas.num_fotos }}</span>
            </div>
            <div class="info-item">
              <strong>Videos:</strong>
              <span>{{ manifestData.estadisticas.num_videos }}</span>
            </div>
            <div class="info-item">
              <strong>Audios:</strong>
              <span>{{ manifestData.estadisticas.num_audios }}</span>
            </div>
            <div class="info-item">
              <strong>Archivos:</strong>
              <span>{{ archivosSeleccionados.length }} ({{ getTamanoTotal() }})</span>
            </div>
          </div>
        </div>

        <!-- AVISO DE VIDEOS DETECTADOS -->
        <div class="video-alert" *ngIf="videosRequeridos">
          <div class="alert-content" [class.success]="videosSeleccionados" [class.ignored]="ignorarVideos">
            <div class="icon">
              {{ videosSeleccionados ? '‚úÖ' : (ignorarVideos ? '‚ö†Ô∏è' : 'üìπ') }}
            </div>
            <div class="text">
              <h4>
                {{ videosSeleccionados ? 'Videos listos para importar' : (ignorarVideos ? 'Importaci√≥n de videos
                omitida' : 'Videos detectados') }}
              </h4>
              <p *ngIf="!videosSeleccionados && !ignorarVideos">
                Este viaje contiene videos. Por favor selecciona la carpeta: <br>
                <code>.../DCIM/AudioPhotoApp/videos</code>
              </p>
              <p *ngIf="ignorarVideos">
                Se importar√° el viaje sin los archivos de video.
              </p>
              <p *ngIf="videosSeleccionados">
                Se han cargado {{ archivosVideo.length }} videos correctamente.
              </p>
            </div>
          </div>

          <div class="video-actions" *ngIf="!videosSeleccionados">
            <button *ngIf="!ignorarVideos" class="btn btn-video" (click)="seleccionarCarpetaVideos()">
              üìÇ Seleccionar Carpeta de Videos
            </button>

            <button class="btn btn-ignore" (click)="ignorarVideos = !ignorarVideos">
              {{ ignorarVideos ? 'üîÑ Volver a intentar' : '‚è≠Ô∏è Omitir videos' }}
            </button>
          </div>
        </div>

        <!-- Separador -->
        <hr class="divider">

        <!-- Formulario de Configuraci√≥n -->
        <div class="config-form">
          <h3>‚öôÔ∏è Configuraci√≥n</h3>

          <!-- Campo: Destino -->
          <div class="form-group">
            <label for="destino">
              üó∫Ô∏è Destino del viaje:
            </label>
            <input type="text" id="destino" [(ngModel)]="destinoViaje" placeholder="Ej: M√°laga, Espa√±a"
              class="form-input" required>
          </div>

          <!-- Campo: Tipo de Actividad -->
          <div class="form-group">
            <label for="tipoActividad">
              üèÉ Tipo de actividad:
            </label>
            <select id="tipoActividad" [(ngModel)]="tipoActividadId" class="form-select" required>
              <option [value]="null" disabled selected>Selecciona una actividad</option>
              <option *ngFor="let tipo of tiposActividad" [value]="tipo.id">
                {{ tipo.nombre }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- ============================================ -->
      <!-- Vista de Progreso (durante importaci√≥n)     -->
      <!-- ============================================ -->
      <div *ngIf="importando" class="progress-container">
        <h3>‚è≥ Importando...</h3>

        <!-- Barra de Progreso -->
        <div class="progress-bar-container">
          <div class="progress-bar" [style.width.%]="progresoSubida">
            {{ progresoSubida }}%
          </div>
        </div>

        <!-- Mensaje de Progreso -->
        <p class="progress-message">{{ mensajeProgreso }}</p>

        <!-- Spinner -->
        <div class="spinner"></div>
      </div>

    </div>

    <!-- Footer del Modal -->
    <div class="modal-footer">
      <button class="btn btn-cancel" (click)="cancelarImportacion()" [disabled]="importando">
        Cancelar
      </button>
      <button class="btn btn-confirm" (click)="confirmarImportacion()"
        [disabled]="importando || !destinoViaje || !tipoActividadId || (videosRequeridos && !videosSeleccionados && !ignorarVideos)">
        Importar
      </button>
    </div>

  </div>
</div>